// Copyright  2024 Tamás Gulácsi. All rights reserved.
//
// SPDX-License-Identifier: Apache-2.0

package bankinap_test

import (
	"context"
	"encoding/json"
	"testing"
	"time"

	"github.com/google/go-cmp/cmp"

	"github.com/UNO-SOFT/bankinap"
)

func TestGet(t *testing.T) {
	ctx, cancel := context.WithTimeout(context.Background(), 10*time.Second)
	defer cancel()
	U, err := bankinap.SearchXLSXURL(ctx, 2025)
	if err != nil {
		t.Fatal(err)
	}
	t.Log("U:", U)

	got, err := bankinap.Get(ctx, U)
	if err != nil {
		t.Fatal(err)
	}
	b, err := json.Marshal(got)
	if err != nil {
		t.Fatal(err)
	}
	t.Log("got:", string(b))
	const want2025 = `[{"Date":"2025-01-01"},{"Date":"2025-01-02","Open":true},{"Date":"2025-01-03","Open":true},{"Date":"2025-01-04"},{"Date":"2025-01-05"},{"Date":"2025-01-06","Open":true},{"Date":"2025-01-07","Open":true},{"Date":"2025-01-08","Open":true},{"Date":"2025-01-09","Open":true},{"Date":"2025-01-10","Open":true},{"Date":"2025-01-11"},{"Date":"2025-01-12"},{"Date":"2025-01-13","Open":true},{"Date":"2025-01-14","Open":true},{"Date":"2025-01-15","Open":true},{"Date":"2025-01-16","Open":true},{"Date":"2025-01-17","Open":true},{"Date":"2025-01-18"},{"Date":"2025-01-19"},{"Date":"2025-01-20","Open":true},{"Date":"2025-01-21","Open":true},{"Date":"2025-01-22","Open":true},{"Date":"2025-01-23","Open":true},{"Date":"2025-01-24","Open":true},{"Date":"2025-01-25"},{"Date":"2025-01-26"},{"Date":"2025-01-27","Open":true},{"Date":"2025-01-28","Open":true},{"Date":"2025-01-29","Open":true},{"Date":"2025-01-30","Open":true},{"Date":"2025-01-31","Open":true},{"Date":"2025-02-01"},{"Date":"2025-02-02"},{"Date":"2025-02-03","Open":true},{"Date":"2025-02-04","Open":true},{"Date":"2025-02-05","Open":true},{"Date":"2025-02-06","Open":true},{"Date":"2025-02-07","Open":true},{"Date":"2025-02-08"},{"Date":"2025-02-09"},{"Date":"2025-02-10","Open":true},{"Date":"2025-02-11","Open":true},{"Date":"2025-02-12","Open":true},{"Date":"2025-02-13","Open":true},{"Date":"2025-02-14","Open":true},{"Date":"2025-02-15"},{"Date":"2025-02-16"},{"Date":"2025-02-17","Open":true},{"Date":"2025-02-18","Open":true},{"Date":"2025-02-19","Open":true},{"Date":"2025-02-20","Open":true},{"Date":"2025-02-21","Open":true},{"Date":"2025-02-22"},{"Date":"2025-02-23"},{"Date":"2025-02-24","Open":true},{"Date":"2025-02-25","Open":true},{"Date":"2025-02-26","Open":true},{"Date":"2025-02-27","Open":true},{"Date":"2025-02-28","Open":true},{"Date":"2025-03-01"},{"Date":"2025-03-02"},{"Date":"2025-03-03","Open":true},{"Date":"2025-03-04","Open":true},{"Date":"2025-03-05","Open":true},{"Date":"2025-03-06","Open":true},{"Date":"2025-03-07","Open":true},{"Date":"2025-03-08"},{"Date":"2025-03-09"},{"Date":"2025-03-10","Open":true},{"Date":"2025-03-11","Open":true},{"Date":"2025-03-12","Open":true},{"Date":"2025-03-13","Open":true},{"Date":"2025-03-14","Open":true},{"Date":"2025-03-15"},{"Date":"2025-03-16"},{"Date":"2025-03-17","Open":true},{"Date":"2025-03-18","Open":true},{"Date":"2025-03-19","Open":true},{"Date":"2025-03-20","Open":true},{"Date":"2025-03-21","Open":true},{"Date":"2025-03-22"},{"Date":"2025-03-23"},{"Date":"2025-03-24","Open":true},{"Date":"2025-03-25","Open":true},{"Date":"2025-03-26","Open":true},{"Date":"2025-03-27","Open":true},{"Date":"2025-03-28","Open":true},{"Date":"2025-03-29"},{"Date":"2025-03-30"},{"Date":"2025-03-31","Open":true},{"Date":"2025-05-01"},{"Date":"2025-05-02"},{"Date":"2025-05-03"},{"Date":"2025-05-04"},{"Date":"2025-05-05","Open":true},{"Date":"2025-05-06","Open":true},{"Date":"2025-05-07","Open":true},{"Date":"2025-05-08","Open":true},{"Date":"2025-05-09","Open":true},{"Date":"2025-05-10"},{"Date":"2025-05-11"},{"Date":"2025-05-12","Open":true},{"Date":"2025-05-13","Open":true},{"Date":"2025-05-14","Open":true},{"Date":"2025-05-15","Open":true},{"Date":"2025-05-16","Open":true},{"Date":"2025-05-17","Open":true,"Exchange":true},{"Date":"2025-05-18"},{"Date":"2025-05-19","Open":true},{"Date":"2025-05-20","Open":true},{"Date":"2025-05-21","Open":true},{"Date":"2025-05-22","Open":true},{"Date":"2025-05-23","Open":true},{"Date":"2025-05-24"},{"Date":"2025-05-25"},{"Date":"2025-05-26","Open":true},{"Date":"2025-05-27","Open":true},{"Date":"2025-05-28","Open":true},{"Date":"2025-05-29","Open":true},{"Date":"2025-05-30","Open":true},{"Date":"2025-05-31"},{"Date":"2025-06-01"},{"Date":"2025-06-02","Open":true},{"Date":"2025-06-03","Open":true},{"Date":"2025-06-04","Open":true},{"Date":"2025-06-05","Open":true},{"Date":"2025-06-06","Open":true},{"Date":"2025-06-07"},{"Date":"2025-06-08"},{"Date":"2025-06-09"},{"Date":"2025-06-10","Open":true},{"Date":"2025-06-11","Open":true},{"Date":"2025-06-12","Open":true},{"Date":"2025-06-13","Open":true},{"Date":"2025-06-14"},{"Date":"2025-06-15"},{"Date":"2025-06-16","Open":true},{"Date":"2025-06-17","Open":true},{"Date":"2025-06-18","Open":true},{"Date":"2025-06-19","Open":true},{"Date":"2025-06-20","Open":true},{"Date":"2025-06-21"},{"Date":"2025-06-22"},{"Date":"2025-06-23","Open":true},{"Date":"2025-06-24","Open":true},{"Date":"2025-06-25","Open":true},{"Date":"2025-06-26","Open":true},{"Date":"2025-06-27","Open":true},{"Date":"2025-06-28"},{"Date":"2025-06-29"},{"Date":"2025-06-30","Open":true},{"Date":"2025-07-01","Open":true},{"Date":"2025-07-02","Open":true},{"Date":"2025-07-03","Open":true},{"Date":"2025-07-04","Open":true},{"Date":"2025-07-05"},{"Date":"2025-07-06"},{"Date":"2025-07-07","Open":true},{"Date":"2025-07-08","Open":true},{"Date":"2025-07-09","Open":true},{"Date":"2025-07-10","Open":true},{"Date":"2025-07-11","Open":true},{"Date":"2025-07-12"},{"Date":"2025-07-13"},{"Date":"2025-07-14","Open":true},{"Date":"2025-07-15","Open":true},{"Date":"2025-07-16","Open":true},{"Date":"2025-07-17","Open":true},{"Date":"2025-07-18","Open":true},{"Date":"2025-07-19"},{"Date":"2025-07-20"},{"Date":"2025-07-21","Open":true},{"Date":"2025-07-22","Open":true},{"Date":"2025-07-23","Open":true},{"Date":"2025-07-24","Open":true},{"Date":"2025-07-25","Open":true},{"Date":"2025-07-26"},{"Date":"2025-07-27"},{"Date":"2025-07-28","Open":true},{"Date":"2025-07-29","Open":true},{"Date":"2025-07-30","Open":true},{"Date":"2025-07-31","Open":true},{"Date":"2025-08-01","Open":true},{"Date":"2025-08-02"},{"Date":"2025-08-03"},{"Date":"2025-08-04","Open":true},{"Date":"2025-08-05","Open":true},{"Date":"2025-08-06","Open":true},{"Date":"2025-08-07","Open":true},{"Date":"2025-08-08","Open":true},{"Date":"2025-08-09"},{"Date":"2025-08-10"},{"Date":"2025-08-11","Open":true},{"Date":"2025-08-12","Open":true},{"Date":"2025-08-13","Open":true},{"Date":"2025-08-14","Open":true},{"Date":"2025-08-15","Open":true},{"Date":"2025-08-16"},{"Date":"2025-08-17"},{"Date":"2025-08-18","Open":true},{"Date":"2025-08-19","Open":true},{"Date":"2025-08-20"},{"Date":"2025-08-21","Open":true},{"Date":"2025-08-22","Open":true},{"Date":"2025-08-23"},{"Date":"2025-08-24"},{"Date":"2025-08-25","Open":true},{"Date":"2025-08-26","Open":true},{"Date":"2025-08-27","Open":true},{"Date":"2025-08-28","Open":true},{"Date":"2025-08-29","Open":true},{"Date":"2025-08-30"},{"Date":"2025-08-31"},{"Date":"2025-09-01","Open":true},{"Date":"2025-09-02","Open":true},{"Date":"2025-09-03","Open":true},{"Date":"2025-09-04","Open":true},{"Date":"2025-09-05","Open":true},{"Date":"2025-09-06"},{"Date":"2025-09-07"},{"Date":"2025-09-08","Open":true},{"Date":"2025-09-09","Open":true},{"Date":"2025-09-10","Open":true},{"Date":"2025-09-11","Open":true},{"Date":"2025-09-12","Open":true},{"Date":"2025-09-13"},{"Date":"2025-09-14"},{"Date":"2025-09-15","Open":true},{"Date":"2025-09-16","Open":true},{"Date":"2025-09-17","Open":true},{"Date":"2025-09-18","Open":true},{"Date":"2025-09-19","Open":true},{"Date":"2025-09-20"},{"Date":"2025-09-21"},{"Date":"2025-09-22","Open":true},{"Date":"2025-09-23","Open":true},{"Date":"2025-09-24","Open":true},{"Date":"2025-09-25","Open":true},{"Date":"2025-09-26","Open":true},{"Date":"2025-09-27"},{"Date":"2025-09-28"},{"Date":"2025-09-29","Open":true},{"Date":"2025-09-30","Open":true},{"Date":"2025-10-01","Open":true},{"Date":"2025-10-02","Open":true},{"Date":"2025-10-03","Open":true},{"Date":"2025-10-04"},{"Date":"2025-10-05"},{"Date":"2025-10-06","Open":true},{"Date":"2025-10-07","Open":true},{"Date":"2025-10-08","Open":true},{"Date":"2025-10-09","Open":true},{"Date":"2025-10-10","Open":true},{"Date":"2025-10-11"},{"Date":"2025-10-12"},{"Date":"2025-10-13","Open":true},{"Date":"2025-10-14","Open":true},{"Date":"2025-10-15","Open":true},{"Date":"2025-10-16","Open":true},{"Date":"2025-10-17","Open":true},{"Date":"2025-10-18","Open":true,"Exchange":true},{"Date":"2025-10-19"},{"Date":"2025-10-20","Open":true},{"Date":"2025-10-21","Open":true},{"Date":"2025-10-22","Open":true},{"Date":"2025-10-23"},{"Date":"2025-10-24"},{"Date":"2025-10-25"},{"Date":"2025-10-26"},{"Date":"2025-10-27","Open":true},{"Date":"2025-10-28","Open":true},{"Date":"2025-10-29","Open":true},{"Date":"2025-10-30","Open":true},{"Date":"2025-10-31","Open":true},{"Date":"2025-11-01"},{"Date":"2025-11-02"},{"Date":"2025-11-03","Open":true},{"Date":"2025-11-04","Open":true},{"Date":"2025-11-05","Open":true},{"Date":"2025-11-06","Open":true},{"Date":"2025-11-07","Open":true},{"Date":"2025-11-08"},{"Date":"2025-11-09"},{"Date":"2025-11-10","Open":true},{"Date":"2025-11-11","Open":true},{"Date":"2025-11-12","Open":true},{"Date":"2025-11-13","Open":true},{"Date":"2025-11-14","Open":true},{"Date":"2025-11-15"},{"Date":"2025-11-16"},{"Date":"2025-11-17","Open":true},{"Date":"2025-11-18","Open":true},{"Date":"2025-11-19","Open":true},{"Date":"2025-11-20","Open":true},{"Date":"2025-11-21","Open":true},{"Date":"2025-11-22"},{"Date":"2025-11-23"},{"Date":"2025-11-24","Open":true},{"Date":"2025-11-25","Open":true},{"Date":"2025-11-26","Open":true},{"Date":"2025-11-27","Open":true},{"Date":"2025-11-28","Open":true},{"Date":"2025-11-29"},{"Date":"2025-11-30"},{"Date":"2025-12-01","Open":true},{"Date":"2025-12-02","Open":true},{"Date":"2025-12-03","Open":true},{"Date":"2025-12-04","Open":true},{"Date":"2025-12-05","Open":true},{"Date":"2025-12-06"},{"Date":"2025-12-07"},{"Date":"2025-12-08","Open":true},{"Date":"2025-12-09","Open":true},{"Date":"2025-12-10","Open":true},{"Date":"2025-12-11","Open":true},{"Date":"2025-12-12","Open":true},{"Date":"2025-12-13","Open":true,"Exchange":true},{"Date":"2025-12-14"},{"Date":"2025-12-15","Open":true},{"Date":"2025-12-16","Open":true},{"Date":"2025-12-17","Open":true},{"Date":"2025-12-18","Open":true},{"Date":"2025-12-19","Open":true},{"Date":"2025-12-20"},{"Date":"2025-12-21"},{"Date":"2025-12-22","Open":true},{"Date":"2025-12-23","Open":true},{"Date":"2025-12-24"},{"Date":"2025-12-25"},{"Date":"2025-12-26"},{"Date":"2025-12-27"},{"Date":"2025-12-28"},{"Date":"2025-12-29","Open":true},{"Date":"2025-12-30","Open":true},{"Date":"2025-12-31","Open":true}]`
	want := make([]bankinap.Day, 0, 366)
	if err := json.Unmarshal([]byte(want2025), &want); err != nil {
		t.Fatal(err)
	}
	if d := cmp.Diff(got, want); d != "" {
		t.Error(d)
	}
}
